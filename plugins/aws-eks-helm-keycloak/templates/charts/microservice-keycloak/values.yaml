# Default values for microservice with Keycloak authentication
# This is a YAML-formatted file.

# -- Number of replicas
replicaCount: 1

image:
  # -- Image repository (set by CI/CD)
  repository: ""
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to chart appVersion)
  tag: ""

# -- Image pull secrets
imagePullSecrets: []
# -- Override chart name
nameOverride: ""
# -- Override full name
fullnameOverride: ""

serviceAccount:
  # -- Create service account
  create: true
  # -- Service account annotations (for IRSA)
  annotations: {}
    # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/my-role
  # -- Service account name
  name: ""

# -- Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

# -- Pod labels
podLabels: {}

# -- Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# -- Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

service:
  # -- Service type
  type: ClusterIP
  # -- Service port
  port: 80
  # -- Container target port
  targetPort: 3000

ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: "alb"
  # -- Ingress annotations
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
  # -- Ingress hosts
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  # -- Ingress TLS configuration
  tls: []

# -- Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Horizontal Pod Autoscaler
autoscaling:
  # -- Enable HPA
  enabled: true
  # -- Minimum replicas
  minReplicas: 2
  # -- Maximum replicas
  maxReplicas: 10
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80

# -- Node selector
nodeSelector: {}

# -- Tolerations
tolerations: []

# -- Affinity rules
affinity: {}

# =============================================================================
# KEYCLOAK CONFIGURATION
# =============================================================================
keycloak:
  # -- Enable Keycloak authentication
  enabled: true
  # -- Keycloak server URL
  url: ""
  # -- Keycloak realm
  realm: ""
  # -- Client ID for this service
  clientId: ""
  # -- Reference to Kubernetes secret containing client secret
  clientSecretRef:
    name: ""
    key: "client-secret"
  # -- OIDC configuration (auto-discovered if url is set)
  oidc:
    # -- OIDC issuer URI (defaults to url/realms/realm)
    issuerUri: ""
    # -- JWKS URI for token validation
    jwksUri: ""

# =============================================================================
# AWS CONFIGURATION
# =============================================================================
aws:
  # -- AWS region
  region: "us-west-2"
  # -- IAM role ARN for IRSA (sets serviceAccount annotation)
  iamRoleArn: ""
  # -- Custom endpoint (for LocalStack)
  endpoint: ""

# =============================================================================
# EXTERNAL SECRETS
# =============================================================================
externalSecrets:
  # -- Enable external secrets
  enabled: true
  # -- Secret store reference
  secretStoreRef: "aws-secrets-manager"
  # -- Refresh interval
  refreshInterval: "1h"
  # -- Secrets to sync
  secrets: []
    # - name: keycloak-client-secret
    #   remoteRef:
    #     key: service-name/keycloak-client-secret

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================
# -- Additional environment variables
env: []
  # - name: LOG_LEVEL
  #   value: "info"

# -- Environment variables from secrets/configmaps
envFrom: []
  # - secretRef:
  #     name: my-secret

# =============================================================================
# HEALTH CHECKS
# =============================================================================
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

# =============================================================================
# POD DISRUPTION BUDGET
# =============================================================================
podDisruptionBudget:
  # -- Enable PDB
  enabled: true
  # -- Minimum available pods
  minAvailable: 1

# =============================================================================
# NETWORK POLICY
# =============================================================================
networkPolicy:
  # -- Enable network policy
  enabled: false
  # -- Ingress rules
  ingress: []
  # -- Egress rules
  egress: []

# =============================================================================
# SERVICE MONITOR (Prometheus)
# =============================================================================
serviceMonitor:
  # -- Enable ServiceMonitor
  enabled: true
  # -- Scrape interval
  interval: "30s"
  # -- Metrics path
  path: "/metrics"
  # -- Additional labels
  labels: {}
