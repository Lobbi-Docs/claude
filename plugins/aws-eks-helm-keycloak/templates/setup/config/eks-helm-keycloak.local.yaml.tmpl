# EKS + Helm + Keycloak Plugin Configuration
# Generated by /eks:setup on ${SETUP_DATE}
#
# This file stores your project-specific configuration.
# It is safe to commit to version control (no secrets stored here).

plugin:
  name: aws-eks-helm-keycloak
  version: "1.0.0"
  setupCompleted: true
  setupDate: "${SETUP_DATE}"

# AWS Configuration
aws:
  region: "${AWS_REGION}"
  accountId: "${AWS_ACCOUNT_ID}"
  secretsPrefix: "${PROJECT_NAME}/"

  # EKS Clusters
  clusters:
    development: "${EKS_CLUSTER_DEV}"
    staging: "${EKS_CLUSTER_STAGING}"
    production: "${EKS_CLUSTER_PROD}"

  # ECR Configuration
  ecr:
    registry: "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com"
    autoCreate: true

# Harness Configuration
harness:
  baseUrl: "${HARNESS_BASE_URL:-https://app.harness.io}"
  accountId: "${HARNESS_ACCOUNT_ID}"
  orgId: "${HARNESS_ORG_ID}"
  projectId: "${HARNESS_PROJECT_ID}"

  # Code Repository
  codeProvider: "${CODE_PROVIDER:-harness}"  # harness, github, gitlab, bitbucket
  codeRepo: "${CODE_REPO}"
  defaultBranch: "${DEFAULT_BRANCH:-main}"

  # Connectors
  connectors:
    aws: "${AWS_CONNECTOR:-aws_connector}"
    eksDev: "${EKS_DEV_CONNECTOR:-eks_dev_connector}"
    eksStaging: "${EKS_STAGING_CONNECTOR:-eks_staging_connector}"
    eksProd: "${EKS_PROD_CONNECTOR:-eks_prod_connector}"
    ecr: "${ECR_CONNECTOR:-ecr_connector}"

# Keycloak Configuration
keycloak:
  # URLs per environment
  urls:
    development: "${KEYCLOAK_URL_DEV:-https://keycloak.dev.${DOMAIN}}"
    staging: "${KEYCLOAK_URL_STAGING:-https://keycloak.staging.${DOMAIN}}"
    production: "${KEYCLOAK_URL_PROD:-https://keycloak.${DOMAIN}}"

  # Realm Configuration
  realms:
    development: "${KEYCLOAK_REALM_DEV:-development}"
    staging: "${KEYCLOAK_REALM_STAGING:-staging}"
    production: "${KEYCLOAK_REALM_PROD:-production}"

  # Client Configuration
  client:
    namingPattern: "{service}-client"
    protocol: openid-connect
    accessType: confidential
    standardFlowEnabled: true
    serviceAccountsEnabled: true
    pkceEnabled: true
    pkceMethod: S256

  # Admin Credentials (reference to Secrets Manager)
  adminSecretRef: "${PROJECT_NAME}/keycloak-admin"

# Local Development
localDev:
  configured: true

  # Ports
  ports:
    app: ${LOCAL_APP_PORT:-3000}
    keycloak: ${LOCAL_KEYCLOAK_PORT:-8080}
    localstack: ${LOCAL_LOCALSTACK_PORT:-4566}
    registry: ${LOCAL_REGISTRY_PORT:-5000}

  # Kind Cluster
  kind:
    clusterName: "${KIND_CLUSTER_NAME:-eks-local}"
    kubernetesVersion: "${K8S_VERSION:-1.28}"

  # Test Users
  testUsers:
    - username: testuser
      roles: [user]
    - username: testadmin
      roles: [admin, user]
    - username: developer
      roles: [developer, user]

# Deployment Configuration
deployment:
  # Default values per environment
  environments:
    development:
      strategy: rolling
      replicas: 1
      approvalRequired: false
    staging:
      strategy: rolling
      replicas: 2
      approvalRequired: false
    production:
      strategy: canary
      canarySteps: [10, 50, 100]
      replicas: 3
      approvalRequired: true

# Helm Configuration
helm:
  chartPath: "charts/${SERVICE_NAME}"
  valuesFiles:
    - values.yaml
    - "values-${ENV}.yaml"

# Security Configuration
security:
  scanners:
    - trivy
    - checkov
  severityThreshold: HIGH
  failOnVulnerabilities: true

# Notifications
notifications:
  slack:
    enabled: ${SLACK_ENABLED:-false}
    webhookSecretRef: "${PROJECT_NAME}/slack-webhook"
